<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    <template id="runbot.build_stats">
      <t t-call='website.layout'>
          <t t-set="bundles" t-value="build.slot_ids.mapped('batch_id.bundle_id')"/>
          <div>
            <div class="row">
              <div class="col-md-4">
                <div class="bg-success-light">
                  <b>Build: </b><a t-attf-href="/runbot/build/{{build.id}}"><t t-esc="build.id"/></a><br/>
                  <b>Config: </b><t t-esc="build.params_id.config_id.name" /><br/>
                  <b>Bundle(s): </b>
                  <t t-foreach="bundles" t-as="bundle">
                    <a t-attf-href="/runbot/bundle/{{bundle.id}}"><t t-esc="bundle.name" /></a>
                  </t>
                </div>
              </div>
              <div t-foreach="sorted(build_stats.keys())" t-as="category" class="col-md-4">
                <h3><t t-esc="category.title().replace('_', ' ')"/></h3>
                <table class="table table-condensed table-responsive table-stripped">
                  <tr t-foreach="build_stats[category].keys()" t-as="module">
                    <td><t t-esc="module"/></td>
                    <td><t t-esc="build_stats[category][module]"/></td>
                  </tr>
                </table>
              </div>
              <div t-if="not build_stats" class="col-md-12 alert alert-warning">No stats records found for this build</div>
            </div>
          </div>
      </t>
    </template>

    <template id="runbot.modules_stats">
      <t t-call='website.layout'>
        <input type="hidden" id="bundle_id" t-att-value="bundle.id"/>
        <input type="hidden" id="trigger_id" t-att-value="trigger.id"/>
        <div class="container-fluid">
          <div class="bg-success-light">
            <b>Bundle:</b><t t-esc="bundle.name"/><br/>
            <b>Trigger:</b><t t-esc="trigger.name"/>
            <b>Stat Category:</b>
            <select id="category_selector" class="form-select" aria-label="Stat Category">
              <option t-foreach="stats_categories" t-as="category" t-attf-value="{{category}}"><t t-esc="category.replace('_',' ').title()"/></option>
            </select>
            <b>Mode: </b>
            <select id="mode_selector" class="form-select" aria-label="Display mode">
              <option selected="selected" value="normal">Normal</option>
              <option value="difference">Difference</option>
            </select>
          </div>
        <canvas id="canvas"></canvas>
        </div>
      </t>
      <script type="text/javascript" src="/runbot/static/src/js/stats.js"></script>
    </template>
  </data>
</odoo>